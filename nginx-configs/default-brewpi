# Default server configuration
# Defaulting default server to brewpi-django
server {
	listen 80 default_server;
	listen [::]:80 default_server;

    # TODO - Get this to actually update based on the username we're installing to
	root /home/brewpi/brewpi-django;

	server_name _;

    location / {
      try_files /off.html @applocation;
    }

    location @applocation {
      proxy_set_header X-Forwarded-For $proxy_add_x_forwarded_for;
      proxy_set_header Host $http_host;
      proxy_redirect off;
      proxy_pass http://127.0.0.1:8123;
    }

    location /static {
      # TODO - Get this to actually update based on the username we're installing to
      alias /home/brewpi/brewpi-django/static_collected/;
      access_log off;
      expires 30s;
      log_not_found off;
    }

    location /media {
      # TODO - Get this to actually update based on the username we're installing to
      alias /home/brewpi/brewpi-django/media/;
      access_log off;
      expires 90s;
      log_not_found off;
    }

    # alias favicon.* to static
    location ~ ^/favicon.(\w*)$ {
      # TODO - Get this to actually update based on the username we're installing to
      alias /home/brewpi/brewpi-django/static_collected/favicon.$1;
      access_log off;
      expires 90s;
      log_not_found off;
    }
}
